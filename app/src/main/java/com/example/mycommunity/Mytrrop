package com.example.mycommunity;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.app.Dialog;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.view.Gravity;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;

import com.google.android.gms.auth.api.signin.GoogleSignIn;
import com.google.android.gms.auth.api.signin.GoogleSignInAccount;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.orhanobut.dialogplus.DialogPlus;
import com.orhanobut.dialogplus.ViewHolder;

import java.util.HashMap;
import java.util.Map;

public class MyTroopActivity extends AppCompatActivity {
    Button signOutBtn;
    ImageButton newsArticleBtn, volunteerBtn, homeBtn, donationBtn, myTroopBtn;

    Button Edit;

    TextView Fname, Email, DOB, Age, Gender;


    protected void onBindViewHolder(@NonNull MyTroopActivity holder, int i, @NonNull MyTroopActivity myTroopActivity){
        holder.Fname.setText(myTroopActivity.getFullName());
        holder.Email.setText(myTroopActivity.getEmail());
        holder.DOB.setText(myTroopActivity.getDateOfBirth());
        holder.Age.setText(myTroopActivity.getAge());
        holder.Gender.setText(myTroopActivity.getGender());
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_my_troop);

        Fname = findViewById(R.id.fname);
        Email = findViewById(R.id.email);
        DOB = findViewById(R.id.dob);
        Age = findViewById(R.id.age);
        Gender = findViewById(R.id.gender);

        Edit = findViewById(R.id.edit);

        Edit.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                DialogPlus dialogPlus = DialogPlus.newDialog(MyTroopActivity.this)
                        .setGravity(Gravity.CENTER)
                        .setMargin(50,0,50,0)
                        .setContentHolder(new ViewHolder(R.layout.edit))
                        .setExpanded(false)
                        .create();

                View holderView = (LinearLayout) dialogPlus.getHolderView();

                EditText Fname = holderView.findViewById(R.id.fname);
                EditText Email = holderView.findViewById(R.id.email);
                EditText DOB = holderView.findViewById(R.id.dob);
                EditText Age = holderView.findViewById(R.id.age);
                EditText Gender = holderView.findViewById(R.id.gender);

                Fname.setText(MyTroopActivity.getFullName());
                Email.setText(MyTroopActivity.getEmail());
                DOB.setText(MyTroopActivity.getDateOfBirth());
                Age.setText(MyTroopActivity.getAge());
                Gender.setText(MyTroopActivity.getGender());

                Button Update = holderView.findViewById(R.id.update);

                Update.setOnClickListener(new View.OnClickListener() {
                    @Override
                    public void onClick(View view) {
                        Map<String, Object> map = new HashMap<>();

                        map.put("FullName", Fname.getText().toString());
                        map.put("Email", Email.getText().toString());
                        map.put("DateOfBirth", DOB.getText().toString());
                        map.put("Age", Age.getText().toString());
                        map.put("Gender", Gender.getText().toString());


                        DatabaseReference db = FirebaseDatabase.getInstance().getReference().child("Sample");
                        GoogleSignInAccount acct = GoogleSignIn.getLastSignedInAccount(MyTroopActivity.this);
                        if(acct!=null){
                            String email = acct.getEmail();
                            assert email != null;
                            db.child(email.replaceAll("[.#$]" , ",")).setValue(map);
                        }
                        else{
                            Toast.makeText(MyTroopActivity.this, "Email is not valid", Toast.LENGTH_SHORT).show();
                        }

//                      .child(getRef(i).getKey())
//                      .updateChildren(map)
                                .addOnCompleteListener(new OnCompleteListener<Void>() {
                                    @Override
                                    public void onComplete(@NonNull Task<Void> task) {
                                        dialogPlus.dismiss();
                                    }
                                });
                    }
                });

                dialogPlus.show();
            }
        });

        volunteerBtn = findViewById(R.id.volunteer_btn);
        homeBtn = findViewById(R.id.home_btn);
        donationBtn = findViewById(R.id.donation_btn);
        myTroopBtn = findViewById(R.id.my_troop_btn);
        newsArticleBtn = findViewById(R.id.new_article_btn);

        volunteerBtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                startActivity(new Intent(MyTroopActivity.this, VolunteerActivity.class));
            }
        });

        homeBtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                startActivity(new Intent(MyTroopActivity.this, MainActivity.class));
            }
        });

        donationBtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                startActivity(new Intent(MyTroopActivity.this, DonationActivity.class));
            }
        });

        myTroopBtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                startActivity(new Intent(MyTroopActivity.this, MyTroopActivity.class));
            }
        });

        newsArticleBtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                startActivity(new Intent(MyTroopActivity.this, NewsActivity.class));
            }
        });
    }


}